# 有关用户留存统计问题的定义

<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [对实际问题的简化和抽象](#对实际问题的简化和抽象)
- [用户留存相关问题定义](#用户留存相关问题定义)

<!-- /code_chunk_output -->

## 对实际问题的简化和抽象

研究 Elasticsearch 如何使用，必须要结合具体问题。

具体的实际问题，比如客户在项目中的实际问题，不适合用于对技术的研究：

- 可能涉及商业秘密
- 有很多和要研究问题本质无关的细节

因此这里将结合一些具体项目需求，抽象出一个简化了的问题，一个有关用户数据留存的统计分析的问题。

简化和抽象并不影响技术方案的主要方面，反而让方案更具有普适性和易于讲解说明。

## 用户留存相关问题定义

用户数据留存的统计分析，在移动互联网服务中是很重要的。

以下是设定的用户数据留存问题的要点：

- 游戏平台，经营若干游戏
- 需要留存相关指标数据

  - 用户留存和留存率
    - 一个指定时间区间`A`的新注册用户，他们的总数记作 `TOTAL_NEW_USERS`
    - 这些用户，在后续某个确定的时间区间`x`（某小时/天/周..），还有活动事件的用户数（排重），记作 `m`，即`A`时间区间新增用户在`x`时间区间的 **用户留存数**
    - `m/TOTAL_NEW_USERS`，即`A`时间区间新增用户在`x`时间区间的 **用户留存率**
  - 游戏留存和留存率

    - 存在 n 款游戏，n>=1
    - 用户可以玩多款游戏
    - 一个游戏由 n 个场景组成，n>1
    - 用户每次打开游戏，会记录`open_game`事件
    - 用户每次玩完一个游戏场景，会
      - 记录`play_game`事件（包括场景 id）
      - 如果玩的游戏场景排重计数>1，记录`play_game`事件附带一个**游戏留存**标记
    - 在时间区间`A`内第一次打开某个指定游戏的用户总数，记作`TOTOL_OPEN_GAME_USERS`
    - 这些用户，在后续的个确定的时间区间`x`（某小时/天/周..）内，记录`play_game`事件且附带**游戏留存**标记的用户数（排重），记作`m`,即`A`时间区间开始玩游戏在`x`时间区间的**用户游戏留存数**
    - `m/TOTOL_OPEN_GAME_USERS`，即`A`时间区间开始玩游戏在`x`时间区间的**用户游戏留存率**

  - 游戏通关和通关率
    - 一个游戏有 n 个关卡，n>0
    - 每个关卡包含 n 个游戏场景，n>0
    - 用户玩通一个关卡，会记录玩完游戏场景事件（同上）并附带关卡 id
    - 在时间区间`A`内，针对某个指定游戏指定关卡 id 有记录`play_game`事件的用户总数（排重），记作 `m`
    - 在时间区间`A`内，针对某个指定游戏，存在`play_game`事件且附带**游戏留存**标记的用户数（排重），即`A`时间区间的**用户游戏留存数**，记作`RETENTION_USERS`
    - `m/RETENTION_USERS`，即`A`时间区间内的某指定游戏的指定关卡的**游戏通关率**
